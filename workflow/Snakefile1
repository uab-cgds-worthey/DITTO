from pathlib import Path

WORKFLOW_PATH = Path(workflow.basedir).parent

configfile:  "/data/project/worthey_lab/projects/experimental_pipelines/mana/small_tasks/cagi6/rgp/data/processed/metadata/train_test_metadata_original.json"
PROCESSED_DIR = Path("/data/project/worthey_lab/projects/experimental_pipelines/tarun/ditto/data/processed/debugged/annotated_vcf")
HAZEL_DIR = Path("/data/project/worthey_lab/projects/experimental_pipelines/tarun/uab-meter/data/processed/fixed")
ANNOTATED_VCF_DIR = Path("/data/project/worthey_lab/projects/experimental_pipelines/tarun/ditto/data/processed/debugged/annotated_vcf")

#TRAIN_TEST = list(config.keys())
SAMPLES = {}
SAMPLES['train'] = list(config['train'].keys())
#SAMPLES['test'] = list(config['test'].keys())


wildcard_constraints:
    sample = "|".join(SAMPLES['train']), #"TRAIN_12|TRAIN_13"
    train_test = "train"
    #train_test = '|'.join(TRAIN_TEST),
    #sample = '|'.join(SAMPLES['train']  + SAMPLES['test']),


rule all:
    input:
        [PROCESSED_DIR / "train" / sample / "Ditto_Hazel_fixed.csv"  for sample in SAMPLES['train'] if "PROBAND" in sample],
        [PROCESSED_DIR / "train" / sample / "Ditto_Hazel_fixed_100.csv" for sample in SAMPLES['train'] if "PROBAND" in sample],
        #expand(str(PROCESSED_DIR / "train/CAGI6_RGP_{sample}_PROBAND/predictions.csv"), sample=SAMPLE_LIST),

rule combine_scores:
    input:
        raw = PROCESSED_DIR /  "train" / "{sample}_vep-annotated_filtered.tsv",
        ditto = PROCESSED_DIR /  "train" / "{sample}" / "ditto_predictions.csv",
        exomiser = HAZEL_DIR / "{sample}" / "Hazel_{sample}.csv" ,
    output:
        pred = PROCESSED_DIR /  "train" / "{sample}" / "Ditto_Hazel_fixed.csv",
        pred_100 = PROCESSED_DIR /  "train" / "{sample}" / "Ditto_Hazel_fixed_100.csv",
    message:
        "Combine Ditto predictions with Hazel: {wildcards.sample}"
    params:
        sample_name = lambda wildcards: f"{wildcards.sample}",
    shell:
        r"""
        python /data/project/worthey_lab/projects/experimental_pipelines/tarun/ditto/src/cohort/combine_scores.py  \
            --raw {input.raw} \
            --ditto {input.ditto} \
            --hazel {input.exomiser} \
            --sample {params.sample_name} \
            -o {output.pred} \
            -o100 {output.pred_100} \
        """
